<!DOCTYPE html>
<html>
	<body>
		<canvas id = "c" width = 1200 height = 800 style = "border: solid 1px black;"></canvas>
		<script>
			var c = document.getElementById("c");
			var ctx = c.getContext("2d");
			
			var mx, my, crect = c.getBoundingClientRect(), button = -1;
			var size = 10, color = "#ff0000";
			
			function rect(x, y, w, h, color){
				ctx.fillStyle = color;
				ctx.fillRect(x, y, w, h);
			}
			function setColor(){
				color = "#" + document.getElementById("color").value;
			}
			function setSize(){
				size = parseInt(document.getElementById("size").value);
			}
			function load(){
				ctx.clearRect(0, 0, c.width, c.height);
				var img = new Image(), path = document.getElementById("load").value;	
				img.src = "assets" + path.substring(path.lastIndexOf("\\"));
				
				img.crossOrigin="anonymous"; 
				console.log(img.src);
				
				img.onload = function(){
					ctx.drawImage(img, 0, 0);				
				}
			}
			function toHex(r, g, b){
				return (r << 16 | g << 8 | b).toString(16);
			}
			
			function update(){
				requestAnimationFrame(update);
				
				if(button == 0)
					rect(mx - (mx % size), my - (my % size), size, size, color);
				else if(button == 2)
					ctx.clearRect(mx - (mx % size), my - (my % size), size, size);
				else if(button == 1){
					var data = ctx.getImageData(mx, my, 1, 1).data;
					color = "#" + ("00000" + toHex(data[0], data[1], data[2])).slice(-6);
					document.getElementById("color").value = color.substring(1);
				}
			}
			update();
			
			window.onkeydown = function(e){
				if(e.keyCode === 16)
					document.getElementById("image").src = c.toDataURL("image/png");
			}
			window.oncontextmenu = function(e){
				return false;
			}
			window.onmousedown = function(e){
				if(e.button === 1)
					e.preventDefault();
				button = e.button;
			}
			window.onmousemove = function(e){
				mx = Math.min(Math.max(e.clientX - crect.left, 0), c.width);
				my = Math.min(Math.max(e.clientY - crect.top, 0), c.height);
			}
			window.onmouseup = function(e){
				button = -1;
			}
		</script>
		<br>
		Color: #<input id = "color" type = "text" value = "ff0000" onchange = "setColor();"/>
		Size: <input id = "size" type = "text" value = "10" onchange = "setSize();"/>
		<button onclick = "ctx.clearRect(0, 0, c.width, c.height);">CLEAR</button>
		Load:<input id = "load" type = "file" accept = "image/*" onchange = "load();"></input>
		<br>
		<img id = "image"></img>
	</body>
</html>